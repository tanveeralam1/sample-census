<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NYC Census Data 2020</title>

  <script src="https://unpkg.com/vue@3"></script>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
  <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>

  <style>
    html, body {
      height: 100%;
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f4f4f4;
    }
    #app {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    header {
      background-color: #003f5c;
      color: white;
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
      flex-shrink: 0;
    }
    .content {
      display: flex;
      flex: 1;
      overflow: hidden;
    }
    #map {
      flex: 2;
      height: 100%;
      min-width: 300px;
    }
    .sidebar {
      flex: 1;
      padding: 1.5rem;
      background-color: white;
      overflow-y: auto;
      box-shadow: -2px 0 5px rgba(0,0,0,0.1);
      min-width: 300px;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .info-title {
      font-weight: bold;
      margin-bottom: 0.75rem;
      color: #003f5c;
      font-size: 1.2rem;
    }
    .info-card {
      background-color: #f1f9ff;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .info-card p {
      margin: 0.5rem 0;
      font-size: 1rem;
    }
    iframe {
      width: 100%;
      height: 215px;
      border: none;
      border-radius: 8px;
    }
    .news-item {
      border-bottom: 1px solid #ccc;
      padding: 0.5rem 0;
    }
    .news-item:last-child {
      border-bottom: none;
    }
    .news-title {
      font-weight: bold;
      font-size: 1rem;
      color: #003f5c;
      margin: 0 0 0.3rem 0;
    }
    .news-source {
      font-size: 0.85rem;
      color: #555;
    }
  </style>
</head>
<body>
  <div id="app">
    <header>NYC Census Data 2020</header>
    <div class="content">
      <div id="map"></div>
      <div class="sidebar">
        <div>
          <div class="info-title">Selected Area Census Data</div>
          <div class="info-card">
            <p><strong>Neighborhood:</strong> {{ neighborhood }}</p>
            <p><strong>Tract ID:</strong> {{ tract }}</p>
            <p><strong>Population:</strong> {{ population }}</p>
            <p><strong>Median Age:</strong> {{ medianAge }}</p>
            <p><strong>Median Income:</strong> {{ medianIncome }}</p>
            <p><strong>County:</strong> {{ county }}</p>
          </div>
        </div>

        <div>
          <div class="info-title">Neighborhood Video</div>
          <div class="info-card">
            <iframe src="https://www.youtube.com/embed/5B0O4mhF_20" allowfullscreen></iframe>
          </div>
        </div>

        <div>
          <div class="info-title">News Reports</div>
          <div class="info-card" v-if="newsReports.length">
            <div v-for="(news, index) in newsReports" :key="index" class="news-item">
              <div class="news-title">{{ news.title }}</div>
              <div class="news-source">{{ news.source }} — {{ news.date }}</div>
            </div>
          </div>
          <div v-else>
            No news reports for this area.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const { createApp, ref, onMounted } = Vue;

    createApp({
      setup() {
        const neighborhood = ref('N/A');
        const tract = ref('N/A');
        const population = ref('N/A');
        const medianAge = ref('N/A');
        const medianIncome = ref('N/A');
        const county = ref('N/A');

        // Mock census data generator (random-ish)
        function generateMockData() {
          return {
            tract: `NYC-${Math.floor(Math.random() * 999)}-${Math.floor(Math.random() * 999)}`,
            population: Math.floor(Math.random() * 50000 + 10000),
            medianAge: (Math.random() * 20 + 25).toFixed(1),
            medianIncome: `$${(Math.floor(Math.random() * 80000) + 30000).toLocaleString()}`,
            county: ['New York', 'Kings', 'Queens', 'Bronx', 'Richmond'][Math.floor(Math.random() * 5)],
          };
        }

        // Mock news reports by neighborhood (static for demo)
        function getMockNewsForNeighborhood(nb) {
          const newsDB = {
            'Upper East Side': [
              { title: "Community Garden Opens in Upper East Side", source: "NY Times", date: "2025-07-01" },
              { title: "Local School Wins Award", source: "NY Daily News", date: "2025-06-15" }
            ],
            Brooklyn: [
              { title: "Brooklyn Bridge Celebrates Anniversary", source: "Brooklyn Eagle", date: "2025-07-02" },
              { title: "New Art Installation in Brooklyn", source: "NY Post", date: "2025-06-20" }
            ],
            Queens: [
              { title: "Queens Farmers Market Expands Hours", source: "Queens Chronicle", date: "2025-07-03" }
            ],
            Bronx: [
              { title: "Bronx Zoo Introduces New Exhibit", source: "Bronx Times", date: "2025-07-04" }
            ],
            Richmond: [
              { title: "Staten Island Ferry Service Updates", source: "SI Advance", date: "2025-07-05" }
            ]
          };
          return newsDB[nb] || [
            { title: "NYC Neighborhood Event Scheduled", source: "NYC News", date: "2025-07-01" }
          ];
        }

        // Fake reverse geocode to get neighborhood name from lat/lng (mock)
        function mockReverseGeocode(lat, lng) {
          const neighborhoods = ['Upper East Side', 'Brooklyn', 'Queens', 'Bronx', 'Richmond'];
          // Random pick for demo
          return neighborhoods[Math.floor(Math.random() * neighborhoods.length)];
        }

        function onLocationSelect(lat, lng) {
          const nb = mockReverseGeocode(lat, lng);
          neighborhood.value = nb;

          const data = generateMockData();
          tract.value = data.tract;
          population.value = data.population;
          medianAge.value = data.medianAge;
          medianIncome.value = data.medianIncome;
          county.value = data.county;

          newsReports.value = getMockNewsForNeighborhood(nb);
        }

        const newsReports = ref([]);

        function initMap() {
          const map = L.map('map').setView([40.7128, -74.006], 11);

          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors',
          }).addTo(map);

          const drawnItems = new L.FeatureGroup();
          map.addLayer(drawnItems);

          const drawControl = new L.Control.Draw({
            edit: {
              featureGroup: drawnItems,
            },
            draw: {
              polygon: true,
              rectangle: true,
              circle: false,
              marker: false,
              polyline: false,
            },
          });

          map.addControl(drawControl);

          map.on(L.Draw.Event.CREATED, function (e) {
            const layer = e.layer;
            drawnItems.clearLayers();
            drawnItems.addLayer(layer);

            const bounds = layer.getBounds();
            const center = bounds.getCenter();
            onLocationSelect(center.lat, center.lng);
          });

          map.on('click', function (e) {
            onLocationSelect(e.latlng.lat, e.latlng.lng);
          });
        }

        onMounted(() => {
          initMap();
        });

        return {
          neighborhood,
          tract,
          population,
          medianAge,
          medianIncome,
          county,
          newsReports
        };
      },
    }).mount('#app');
  </script>
</body>
</html>
